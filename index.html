<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cadê o Bloco? — MVP</title>

  <!-- Leaflet (OpenStreetMap, sem API key) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    :root{
      --bg:#0f0f0f; --bar:#111; --line:#2b2b2b; --muted:#a8a8a8;
      --purple:#8b5cf6;
      --green:#00ff7f; --yellow:#ffd24d; --gray:#9a9a9a; --red:#ff4d4d;
    }
    *{ box-sizing:border-box; }
    body{ margin:0; font-family:Arial, sans-serif; background:var(--bg); color:#fff; }

    /* TOP BAR */
    .topbar{
      height:56px; display:flex; align-items:center; gap:12px;
      padding:10px 12px; background:linear-gradient(#121212, #0f0f0f);
      border-bottom:1px solid var(--line);
      position:sticky; top:0; z-index:10000;
    }
    .brand{ font-weight:900; font-size:14px; white-space:nowrap; }
    .search{
      flex:1; display:flex; align-items:center; gap:10px;
      background:#0c0c0c; border:1px solid var(--line);
      border-radius:999px; padding:10px 14px;
    }
    .search input{
      flex:1; background:transparent; border:none; outline:none;
      color:#fff; font-size:14px;
    }
    .actions{ display:flex; gap:10px; align-items:center; }
    .btn{
      cursor:pointer; font-weight:800;
      border-radius:12px; padding:10px 12px;
      background:#141414; color:#fff; border:1px solid var(--line);
      display:flex; align-items:center; gap:8px;
    }
    .btn.primary{ background:rgba(139,92,246,.18); border-color:rgba(139,92,246,.45); }
    .dot{ width:8px; height:8px; border-radius:50%; background:var(--purple); }

    /* MAP */
    #map{ height:54vh; width:100%; z-index:1; }

    /* LIST */
    .content{ padding:12px; max-width:1200px; margin:0 auto; }
    .sectionTitle{ font-weight:900; margin:10px 0 6px; font-size:14px; }
    .subtle{ color:var(--muted); font-size:12px; margin:0 0 10px; }
    .list{ display:flex; flex-direction:column; gap:10px; }
    .item{
      background:linear-gradient(#151515, #121212);
      border:1px solid var(--line);
      border-radius:14px; padding:12px;
      display:flex; justify-content:space-between; gap:12px;
    }
    .left{ flex:1; }
    .row{ display:flex; align-items:center; gap:8px; }
    .pin{ width:8px; height:8px; border-radius:50%; background:var(--gray); }
    .pin.rolando{ background:var(--green); }
    .pin.terminando{ background:var(--yellow); }
    .pin.programado{ background:var(--gray); }
    .pin.encerrado{ background:var(--red); }
    .meta{ font-size:12px; color:var(--muted); margin-top:6px; }

    /* DRAWER */
    .overlay{
      position:fixed; inset:0; background:rgba(0,0,0,.45);
      opacity:0; pointer-events:none; transition:.2s; z-index:9998;
    }
    .overlay.open{ opacity:1; pointer-events:auto; }

    .drawer{
      position:fixed; top:0; right:0; height:100%;
      width:min(360px,92vw);
      background-color:#121212;
      background:linear-gradient(#121212,#0f0f0f);
      border-left:1px solid var(--line);
      transform:translateX(102%);
      transition:.2s; z-index:9999;
      padding:14px; display:flex; flex-direction:column; gap:12px;
    }
    .drawer.open{ transform:translateX(0); }

    .panel{ border:1px solid var(--line); border-radius:14px; padding:12px; background:#101010; }
    .panel h4{ margin:0 0 8px; font-size:12px; color:var(--muted); }
    .select{
      width:100%; padding:10px; border-radius:10px;
      background:#0c0c0c; color:#fff; border:1px solid var(--line);
    }

    /* Leaflet z-index fix */
    .leaflet-pane, .leaflet-top, .leaflet-bottom, .leaflet-control-container{
      z-index:10 !important;
    }
  </style>
</head>

<body>

<div class="topbar">
  <div class="brand">CADÊ O BLOCO?</div>

  <div class="search">
    <input id="q" placeholder="Buscar bloco (ex.: Serasa)" />
  </div>

  <div class="actions">
    <!-- EU = GPS -->
    <button class="btn primary" id="btnEu">
      <span class="dot"></span> Eu
    </button>

    <!-- FILTROS -->
    <button class="btn" id="btnFiltros">⚙️ Filtros</button>
  </div>
</div>

<div id="map"></div>

<div class="content">
  <div class="sectionTitle">Blocos próximos</div>
  <div class="subtle" id="subtitle">Ordenado por distância (se GPS permitido)</div>
  <div class="list" id="list"></div>
</div>

<div class="overlay" id="overlay"></div>

<aside class="drawer" id="drawer">
  <div class="panel">
    <h4>Região</h4>
    <select class="select" id="region">
      <option value="">Todas</option>
    </select>
  </div>
</aside>

<script>
/* ===== DADOS ===== */
const BLOCOS = [
  { id:"serasa", name:"Bloco do Serasa", region:"Consolação", status:"rolando", lat:-23.5587, lng:-46.6622 },
  { id:"se", name:"Bloco da Sé", region:"Sé", status:"programado", lat:-23.5505, lng:-46.6333 }
];

/* ===== MAPA ===== */
const map = L.map("map").setView([-23.5505,-46.6333],12);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{ maxZoom:19 }).addTo(map);

const layer = L.layerGroup().addTo(map);
let userPos=null, userLayer=null;

function drawUser(lat,lng){
  if(userLayer) map.removeLayer(userLayer);
  const halo=L.circle([lat,lng],{radius:60,color:"#60a5fa",fillColor:"#60a5fa",fillOpacity:.15,weight:1});
  const dot=L.circleMarker([lat,lng],{radius:7,color:"#1d4ed8",fillColor:"#3b82f6",fillOpacity:1,weight:2});
  userLayer=L.layerGroup([halo,dot]).addTo(map);
}

function focusOnMe(){
  if(!navigator.geolocation){
    alert("Geolocalização não disponível.");
    return;
  }
  navigator.geolocation.getCurrentPosition(
    pos=>{
      userPos={lat:pos.coords.latitude,lng:pos.coords.longitude};
      drawUser(userPos.lat,userPos.lng);
      map.setView([userPos.lat,userPos.lng],15);
      render();
    },
    ()=>{
      alert("Permissão de localização negada.");
    },
    { enableHighAccuracy:true, timeout:8000, maximumAge:15000 }
  );
}

/* ===== DRAWER ===== */
const drawer=document.getElementById("drawer");
const overlay=document.getElementById("overlay");
document.getElementById("btnFiltros").onclick=()=>{
  drawer.classList.toggle("open");
  overlay.classList.toggle("open");
};
overlay.onclick=()=>{
  drawer.classList.remove("open");
  overlay.classList.remove("open");
};

/* ===== UI ===== */
document.getElementById("btnEu").onclick=focusOnMe;

function render(){
  layer.clearLayers();
  document.getElementById("list").innerHTML="";
  BLOCOS.forEach(b=>{
    const m=L.circleMarker([b.lat,b.lng],{
      radius:9,
      color:"#00ff7f",
      fillColor:"#00ff7f",
      fillOpacity:.9,weight:0
    }).addTo(layer);

    const div=document.createElement("div");
    div.className="item";
    div.innerHTML=`
      <div class="left">
        <div class="row"><span class="pin ${b.status}"></span><b>${b.name}</b></div>
        <div class="meta">${b.region}</div>
      </div>
    `;
    div.onclick=()=>map.setView([b.lat,b.lng],16);
    document.getElementById("list").appendChild(div);
  });
}

render();
</script>
</body>
</html>
